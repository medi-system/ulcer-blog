---
import { render } from "astro:content";
import BaseLayout from "@/layouts/base.astro";
import ContentLayout from "@/layouts/content.astro";
import ArticleHeader from "./_components/article-header.astro";

import { articlesHandler } from "@/lib/handlers/articles";

export const getStaticPaths = async () => {
  const articles = articlesHandler.allArticles();

  return articles.map((article) => ({
    params: { id: article.id },
    props: { article },
  }));
};
const { article } = Astro.props;

const { Content, remarkPluginFrontmatter } = await render(article);
const pageUrl = Astro.url.href;
const pageId = article.id;
---

<BaseLayout entry={article}>
  <ArticleHeader
    article={article}
    readingTime={remarkPluginFrontmatter.minutesRead}
  />

  <!-- AliExpress Ad -->
  <section class="container max-w-5xl py-4 flex justify-center">
    <a href='https://s.click.aliexpress.com/e/_c4pU8svL?bz=725*90' target='_blank' rel="noopener noreferrer">
      <img width='725' height='90' src='https://ae-pic-a1.aliexpress-media.com/kf/S72fc36ecb4484a429cda8e0d94e341ffU.png' alt="AliExpress" class="max-w-full h-auto" />
    </a>
  </section>

  <ContentLayout>
    <Content />
  </ContentLayout>

  <!-- Coupang Partners -->
  <section class="container max-w-5xl py-8">
    <div id="coupang-ad"></div>
    <script src="https://ads-partners.coupang.com/g.js"></script>
    <script is:inline>
      new PartnersCoupang.G({"id":948700,"template":"carousel","trackingCode":"AF3190673","width":"680","height":"140","tsource":""});
    </script>
  </section>

  <!-- Disqus Comments -->
  <section class="container max-w-5xl py-8">
    <div id="disqus_thread"></div>
    <script define:vars={{ pageUrl, pageId }}>
      var disqus_config = function () {
        this.page.url = pageUrl;
        this.page.identifier = pageId;
      };
      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://medi-note.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
</BaseLayout>